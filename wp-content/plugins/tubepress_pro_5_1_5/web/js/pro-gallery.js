/**
 * @license
 *
 * Copyright 2006 - 2016 TubePress LLC (http://tubepress.com/).
 * This file is part of TubePress Pro.
 * REDISTRIBUTION PROHIBITED. Please see http://tubepress.com/license for details.
 */
!function(e){"use strict";var r=e.Lang.Utils,t=e.Beacon,n=e.Logger,a=t.subscribe,o=t.publish,i=n.on(),l=n.log,u=r.isDefined,s=e.Vendors.jQuery,c=!1,f=!c,g="Gallery",d=".",p="_",v="-",y="item",m="page",h=" ",b="Id",G="id",I="",O=y+b,S="tubepress",A="gallery",P="PlayerApi",E="sequence",x=A+b,j=S+d+A+d,F=j+y+d,D=F+"change",J=F+"next",w=F+"previous",L=F+"start",T=F+"stop",_=j+m+"change",R=j+"load",H=j+"newthumbs",C=function(){var r=function(){return e[g]},t=function(){return e[P]};return{getPlayerApiJs:t,getGalleryJs:r}}(),N=function(e,r,t){return C.getGalleryJs().Options.getOption(e,r,t)},Z=function(){var r=c,t=[],n=function(){return r||u(e[g])},o=function(e){var r,t=0,n=C.getGalleryJs().Registry,a=n.getAll();for(t;t<e.length;t+=1)(r=e[t])(a)},s=function(e){n()?o([e]):t.push(e)},p=function(){r||(i&&l(A+".js is available for Pro"),r=f,o(t))},v=function(e,r){var t,n;for(t in e)e.hasOwnProperty(t)&&(n={},n[x]=t,n.params=e[t],r({},n))};return a(S+d+"js.sys."+A,p),{addGalleryJsReadyHandler:s,runForAllExistingGalleries:v}}(),k=function(){var e=function(e,r){l(A+h+e+h+r)};return{log:e}}(),q=function(){var e={},r={},t={},n=function(){return C.getGalleryJs().Selectors},a=function(r){if(!e.hasOwnProperty(r)){var t=n(),a=t.getOutermostSelectorLegacy(r);e[r]=s(a).length>0}return e[r]},o=function(e){if(!r.hasOwnProperty(e)){var t=n();a(e)?r[e]=t.getOutermostSelectorLegacy(e):r[e]=t.getOutermostSelectorModern(e)}return r[e]},i=function(e){if(!t.hasOwnProperty(e)){var r=n();a(e)?t[e]=r.getThumbAreaSelectorLegacy(e):t[e]=r.getThumbAreaSelectorModern(e)}return t[e]};return{getOutermostSelector:o,getThumbAreaSelector:i}}(),B=function(){var e=function(e){return e[x]},r=function(e){return e[O]};return{getGalleryIdFromEventData:e,getItemIdFromEventData:r}}(),M=function(){var e,r,t={},n=":first",a=d+S+"_container"+n,o="js-"+S+v+A,i=o+v,l=d+o+n,u=S+p+A+p,c=function(t){var n=s("#"+t),o=n.parents(l);if(0===o.length){if(o=n.parents(a),0!==o.length)return o.attr(G).replace(u,I)}else for(e=o.attr("class").split(/\s+/),r=0;r<e.length;r+=1)if(0===e[r].indexOf(i))return e[r].replace(i,I)},f=function(e){var r=e.guid;return M.hasOwnProperty(r)||(t[r]=c(r)),t[r]};return{findGalleryId:f}}(),U=function(){var e={},r={},t=k.log,n=B.getGalleryIdFromEventData,o=B.getItemIdFromEventData,l=function(e){return r[e]},u=function(r){return e[r]===f},s=function(r,n){var a=M.findGalleryId(n);i&&t(a,"stopped"),e[a]=c},g=function(e,n){i&&t(e,"current item is now "+n),r[e]=n},d=function(r,n){var a=M.findGalleryId(n),l=o(n);i&&t(a,"start item "+l),e[a]=f,g(a,l)},p=function(e,r){g(n(r),r[O])},v=function(r,t){var a=n(t),o=N(a,"sequence",[]);o.length>0&&g(a,o[0]),e[a]=c},y=function(e){Z.runForAllExistingGalleries(e,v),a(D,p),a(T,s),a(L,d),a(R,v)};return Z.addGalleryJsReadyHandler(y),{getCurrentItemId:l,isCurrentlyPlayingVideo:u}}(),V=function(){var e=r.parseIntOrZero,t=r.getParameterByName(S+p+m),n=e(t),o=B.getGalleryIdFromEventData,l=k.log,u={},s=function(e){var r=u[e];return""===r?1:r},c=function(r){var t=e(r);return t>0?t:1},f=function(e,r){var t=o(r),a=c(n);i&&l(t,"starting on page "+a),u[t]=a},g=function(e,r){var t=o(r),n=c(r[m]);i&&l(t,"change to page "+n),u[t]=n},d=function(e){Z.runForAllExistingGalleries(e,f),a(R,f),a(_,g)};return Z.addGalleryJsReadyHandler(d),{getCurrentPageNumber:s}}();!function(){var e=function(e,r){var t,n,a=M.findGalleryId(r),i={};a&&(t=N(a,"autoNext",c)===f,n=N(a,E,[]).length>0,t&&n&&(i[x]=a,o(J,i)))};a(T,e)}(),function(){var e=function(e,r){var t=e[x],n=N(t,E,[]),a=U.getCurrentItemId(t),i=s.inArray(a.toString(),n),l={},u=r?n?n.length-1:i:0;i!==-1&&i!==u&&(l[x]=t,l[O]=n[r?i+1:i-1],o(D,l))},r=function(r,t){e(t,f)},t=function(r,t){e(t,c)};a(J,r),a(w,t)}(),function(){var r=function(e){t.publish(H,{galleryId:e})},n=function(t,n){var a=C.getGalleryJs().Options.getEphemeralOptions(t),o=e.Ajax.LoadStyler,l=q.getThumbAreaSelector(t),u=function(){o.removeLoadingStyle(l),r(t)},c={tubepress_action:"shortcode",tubepress_options:a,tubepress_page:n},f=e.Environment.getAjaxEndpointUrl()+h+l+" > *";i&&k.log(t,"load "+f+" into "+l),o.applyLoadingStyle(l),s(l).load(f,c,u)},a=function(e,r){var t=B.getGalleryIdFromEventData(r),a=r[m],o=N(t,"ajaxPagination",!1);o&&n(t,a)};t.subscribe(_,a)}(),function(){var e=function(e){var r=e.parents("div.tubepress_container:first"),t=r.attr("id");return t.replace("tubepress_gallery_","")},r=function(r){var t=s(r.target),n=t.data(m),a={},i=e(t);return r.preventDefault(),a[x]=i,a[m]=n,o(_,a),!1},t=function(e,t){var n=B.getGalleryIdFromEventData(t),a=N(n,"ajaxPagination",c),o=q.getOutermostSelector(n),i=q.getThumbAreaSelector(n),l=o+h+i+h+"div.pagination a";a&&s(l).click(r)},n=function(e){Z.runForAllExistingGalleries(e,t),a(H+h+R,t)};Z.addGalleryJsReadyHandler(n)}(),function(){var e="js-tubepress-page",r=e+"r",t=e+"-",n=function(e){return e.attr("class").split(/\s+/)},i=function(e){var r,a=n(e),o=0;for(o;o<a.length;o+=1)if(r=a[o],0===r.indexOf(t))return r.replace(t,"");return 1},l=function(e){var r,t=e.parents("div.js-tubepress-gallery:first"),a=n(t),o=0;for(o;o<a.length;o+=1)if(r=a[o],0===r.indexOf("js-tubepress-gallery-"))return r.replace("js-tubepress-gallery-","")},u=function(e){var r=s(e.target),t=i(r),n={},a=l(r);return e.preventDefault(),n[x]=a,n[m]=t,o(_,n),!1},f=function(e,t){var n=B.getGalleryIdFromEventData(t),a=N(n,"ajaxPagination",c),o=q.getThumbAreaSelector(n),i=o+" a."+r;a&&s(i).click(u)},g=function(e){Z.runForAllExistingGalleries(e,f),a(H+h+R,f)};Z.addGalleryJsReadyHandler(g)}(),function(){var e=function(e,t){var n="embeddedScroll",a="target",o=t[x],i=N(o,n+"On",f),l=N(o,n+"Duration",0),u=N(o,n+"Offset",0);t.disable=i!==!0,t[a]=r.parseIntOrZero(t[a])+r.parseIntOrZero(u),t.duration=r.parseIntOrZero(l)};t.subscribe(j+".player.scroll",e)}(),e.ProGallery={NowShowing:U,PageTracker:V}}(TubePress);
